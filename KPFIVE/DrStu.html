<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>鲲鹏五班抽人回答问题系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
            padding: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            padding: 25px;
            flex: 1;
            min-width: 300px;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .control-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #444;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="number"]:focus {
            border-color: #4a90e2;
            outline: none;
        }
        
        .toggle-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .toggle-label {
            margin-bottom: 0;
            flex: 1;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: #4a90e2;
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .small-button-group {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .small-button {
            padding: 10px;
            font-size: 14px;
        }
        
        .primary-btn {
            background: linear-gradient(to right, #4a90e2, #63b3ed);
            color: white;
        }
        
        .secondary-btn {
            background: #f1f1f1;
            color: #333;
        }
        
        .success-btn {
            background: linear-gradient(to right, #2ecc71, #1abc9c);
            color: white;
        }
        
        .warning-btn {
            background: linear-gradient(to right, #e74c3c, #e67e22);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .primary-btn:hover {
            background: linear-gradient(to right, #3a7bc8, #4a90e2);
        }
        
        .secondary-btn:hover {
            background: #e0e0e0;
        }
        
        .success-btn:hover {
            background: linear-gradient(to right, #27ae60, #16a085);
        }
        
        .warning-btn:hover {
            background: linear-gradient(to right, #c0392b, #d35400);
        }
        
        .students-container {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .student-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        
        .student-card {
            background: #f9f9f9;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .student-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .student-card.selected {
            background: #e3f2fd;
            border-color: #4a90e2;
        }
        
        .student-card.excluded {
            opacity: 0.5;
            background: #f5f5f5;
        }
        
        .student-id {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .student-name {
            font-weight: bold;
            font-size: 16px;
        }
        
        .result-container {
            text-align: center;
            padding: 30px;
            min-height: 400px;
            display: flex;
            flex-direction: column;
        }
        
        .result-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #444;
        }
        
        .result-display {
            flex: 1;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .result-card {
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
            border-radius: 10px;
            padding: 20px;
            min-width: 150px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            animation: popIn 0.5s ease-out;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .history {
            margin-top: 30px;
        }
        
        .history-title {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #444;
        }
        
        .history-list {
            list-style-type: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .history-item {
            padding: 10px 15px;
            background: #f1f1f1;
            border-radius: 8px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }
        
        /* 动画相关样式 */
        .animation-container {
            position: relative;
            width: 100%;
            height: 200px;
            overflow: hidden;
            border-radius: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .scrolling-student {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 2.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            transition: transform 0.1s linear;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .animation-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2) 0%, transparent 30%, transparent 70%, rgba(0,0,0,0.2) 100%);
            pointer-events: none;
        }
        
        .animation-border {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 3px solid rgba(255,255,255,0.5);
            border-radius: 10px;
            pointer-events: none;
        }
        
        .animation-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 3px;
            background: rgba(255,255,255,0.8);
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            z-index: 10;
            pointer-events: none;
        }
        
        .animation-indicator::before,
        .animation-indicator::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.8);
            border-radius: 50%;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .animation-indicator::before {
            left: -30px;
        }
        
        .animation-indicator::after {
            right: -30px;
        }
        
        .animation-pulse {
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        footer {
            text-align: center;
            color: white;
            padding: 20px;
            margin-top: 30px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .student-list {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            .scrolling-student {
                font-size: 1.8rem;
            }
            
            .animation-container {
                height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>鲲鹏五班抽人回答问题系统</h1>
            <p class="subtitle">随机抽取学生回答问题，支持排除名单和多人抽取</p>
        </header>
        
        <div class="main-content">
            <div class="panel controls">
                <h2>抽取设置</h2>
                <div class="control-group">
                    <label for="cnt">抽取人数</label>
                    <input type="number" id="cnt" min="1" max="29" value="1">
                </div>
                
                <div class="control-group">
                    <div class="toggle-container">
                        <label class="toggle-label">启用滚动动画</label>
                        <label class="toggle-switch">
                            <input type="checkbox" id="animationToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <p style="font-size: 0.9rem; color: #666; margin-top: 5px;">开启后抽取时会有滚动动画效果</p>
                </div>
                
                <div class="control-group">
                    <h3>抽取名单</h3>
                    <p>点击下方（右方）学生卡片可将其加入/移出抽取名单</p>
                </div>
                
                <div class="small-button-group">
                    <button id="selNone" class="success-btn small-button">全选</button>
                    <button id="selAll" class="warning-btn small-button">全不选</button>
                </div>

                <div class="button-group">
                    <button id="drawBtn" class="primary-btn">开始抽取</button>
                    <button id="resetBtn" class="secondary-btn">重置抽取名单</button>
                </div>
            </div>
            
            <div class="panel result-container">
                <h2 class="result-title">抽取结果</h2>
                <div class="result-display" id="resDisplay">
                    <p>点击"开始抽取"按钮显示结果</p>
                </div>
                
                <div class="history">
                    <h3 class="history-title">抽取历史</h3>
                    <ul class="history-list" id="hisList">
                    </ul>
                </div>
            </div>
            
            <div class="panel students-container">
                <h2>班级名单</h2>
                <div class="student-list" id="stuList">
                </div>
            </div>
        </div>
        
        <footer>
            <p>鲲鹏五班抽人系统：NortH开发团队 &copy; 2025</p>
        </footer>
    </div>

    <script>
        const stuData = [
            {name: "白劭溥", weight: 1},
            {name: "曹瀚文", weight: 1},
            {name: "车星伯", weight: 1},
            {name: "丁子煜", weight: 1},
            {name: "丁梓轩", weight: 1},
            {name: "房勇劭", weight: 1},
            {name: "管峭", weight: 1},
            {name: "郭雨佳", weight: 1},
            {name: "何可馨", weight: 1},
            {name: "季节", weight: 1},
            {name: "李朋泽", weight: 1},
            {name: "李恕丞", weight: 1},
            {name: "刘新宇", weight: 1},
            {name: "马天霖", weight: 1},
            {name: "逄皓婷", weight: 1},
            {name: "秦正", weight: 1},
            {name: "司雨菲", weight: 1},
            {name: "苏浩宁", weight: 1},
            {name: "王景赫", weight: 1},
            {name: "王哲临", weight: 1},
            {name: "王紫嫣", weight: 1},
            {name: "徐博宇", weight: 1},
            {name: "杨长城", weight: 1},
            {name: "于乐水", weight: 1},
            {name: "张皓然", weight: 1},
            {name: "张睿宸", weight: 1},
            {name: "张艺川", weight: 1},
            {name: "赵思齐", weight: 1},
            {name: "朱若冲", weight: 1}
        ];

        let excList = [];
        let hisArr = [];
        let isAnimating = false;

        const stuListEl = document.getElementById('stuList');
        const resDisplayEl = document.getElementById('resDisplay');
        const hisListEl = document.getElementById('hisList');
        const drawBtn = document.getElementById('drawBtn');
        const resetBtn = document.getElementById('resetBtn');
        const selAllBtn = document.getElementById('selAll');
        const selNoneBtn = document.getElementById('selNone');
        const cntInput = document.getElementById('cnt');
        const animationToggle = document.getElementById('animationToggle');

        function initStu() {
            stuListEl.innerHTML = '';
            
            stuData.forEach((stu, idx) => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.dataset.id = idx;
                
                card.innerHTML = `
                    <div class="student-id">${idx + 1}号</div>
                    <div class="student-name">${stu.name}</div>
                `;
                
                card.addEventListener('click', () => {
                    toggleStu(idx, card);
                });
                
                stuListEl.appendChild(card);
            });
        }

        function toggleStu(idx, el) {
            if (isAnimating) return;
            
            const isExc = excList.includes(idx);
            
            if (isExc) {
                excList = excList.filter(id => id !== idx);
                el.classList.remove('excluded');
            } else {
                excList.push(idx);
                el.classList.add('excluded');
            }
        }

        function allStu() {
            if (isAnimating) return;
            
            excList = [];
            const cards = document.querySelectorAll('.student-card');
            
            stuData.forEach((_, idx) => {
                excList.push(idx);
            });
            
            cards.forEach(card => {
                card.classList.add('excluded');
            });
        }

        function noneStu() {
            if (isAnimating) return;
            
            excList = [];
            
            const cards = document.querySelectorAll('.student-card');
            cards.forEach(card => {
                card.classList.remove('excluded');
            });
        }

        function getWeightedRandom(arr) {
            const totalWeight = arr.reduce((sum, item) => sum + stuData[item].weight, 0);
            let random = Math.random() * totalWeight;
            
            for (let i = 0; i < arr.length; i++) {
                random -= stuData[arr[i]].weight;
                if (random <= 0) {
                    return i;
                }
            }
            
            return arr.length - 1;
        }

        // 创建动画容器
        function createAnimationContainer() {
            const container = document.createElement('div');
            container.className = 'animation-container';
            
            const scrollingStudent = document.createElement('div');
            scrollingStudent.className = 'scrolling-student';
            scrollingStudent.id = 'scrollingStudent';
            
            const overlay = document.createElement('div');
            overlay.className = 'animation-overlay';
            
            const border = document.createElement('div');
            border.className = 'animation-border';
            
            const indicator = document.createElement('div');
            indicator.className = 'animation-indicator animation-pulse';
            
            container.appendChild(scrollingStudent);
            container.appendChild(overlay);
            container.appendChild(border);
            container.appendChild(indicator);
            
            return container;
        }

        // 滚动动画
        function animateSelection(availableStudents, finalResult, onComplete) {
            isAnimating = true;
            drawBtn.disabled = true;

            const container = createAnimationContainer();
            resDisplayEl.innerHTML = '';
            resDisplayEl.appendChild(container);

            const scrollingEl = document.getElementById('scrollingStudent');
            const availNames = availableStudents.map(idx => stuData[idx].name);

            let speed = 50; // 初始速度 (ms)
            let currentIndex = 0;
            let animationCount = 0;
            const maxAnimations = 30 + Math.floor(Math.random() * 20); // 随机动画次数

            function step() {
                if (availNames.length === 0) {
                    container.remove();
                    isAnimating = false;
                    drawBtn.disabled = false;
                    if (onComplete) onComplete();
                    return;
                }

                currentIndex = (currentIndex + 1) % availNames.length;
                scrollingEl.textContent = availNames[currentIndex];

                animationCount++;

                // 逐渐减速
                if (animationCount > maxAnimations * 0.7) {
                    speed += 25;
                } else if (animationCount > maxAnimations * 0.4) {
                    speed += 15;
                } else if (animationCount > maxAnimations * 0.2) {
                    speed += 10;
                }

                if (animationCount >= maxAnimations) {
                    const finalIndex = availableStudents.findIndex(idx =>
                        finalResult.some(r => r.id === idx)
                    );

                    if (finalIndex !== -1) {
                        currentIndex = finalIndex;
                        scrollingEl.textContent = availNames[currentIndex];
                    }

                    setTimeout(() => {
                        container.remove();
                        showRes(finalResult);
                        addHis(finalResult);
                        isAnimating = false;
                        drawBtn.disabled = false;
                        if (onComplete) onComplete();
                    }, 800);
                } else {
                    setTimeout(step, speed);
                }
            }

            setTimeout(step, speed);
        }

        function drawStu() {
            if (isAnimating) return;
            
            const num = parseInt(cntInput.value) || 1;
            
            const availStu = stuData
                .map((_, idx) => idx)
                .filter(idx => !excList.includes(idx));
            
            if (availStu.length === 0) {
                resDisplayEl.innerHTML = '<p>没有可抽取的学生，请调整排除名单</p>';
                return;
            }
            
            const actualNum = Math.min(num, availStu.length);
            const res = [];
            const tempArr = [...availStu];
            
            for (let i = 0; i < actualNum; i++) {
                if (tempArr.length === 0) break;
                
                const randomIndex = getWeightedRandom(tempArr);
                const stuIdx = tempArr.splice(randomIndex, 1)[0];
                res.push({
                    id: stuIdx,
                    name: stuData[stuIdx].name
                });
            }
            
            // 根据开关状态决定是否使用动画
            if (animationToggle.checked) {
                // 使用动画抽取
                animateSelection(availStu, res);
            } else {
                // 直接显示结果
                showRes(res);
                addHis(res);
            }
        }

        function showRes(res) {
            resDisplayEl.innerHTML = '';
            
            if (res.length === 0) {
                resDisplayEl.innerHTML = '<p>没有可抽取的学生</p>';
                return;
            }
            
            res.forEach(stu => {
                const card = document.createElement('div');
                card.className = 'result-card';
                card.innerHTML = `
                    <div class="student-id">${stu.id + 1}号</div>
                    <div class="student-name">${stu.name}</div>
                `;
                resDisplayEl.appendChild(card);
            });
        }

        function addHis(res) {
            const now = new Date();
            const timeStr = now.toLocaleTimeString();
            
            const item = document.createElement('li');
            item.className = 'history-item';
            
            const names = res.map(s => s.name).join('、');
            item.innerHTML = `
                <span>${timeStr}</span>
                <span>${names}</span>
            `;
            
            hisListEl.insertBefore(item, hisListEl.firstChild);
            
            if (hisListEl.children.length > 10) {
                hisListEl.removeChild(hisListEl.lastChild);
            }
            
            hisArr.unshift({
                time: timeStr,
                students: res
            });
        }

        function resetExc() {
            if (isAnimating) return;
            
            excList = [];
            
            const cards = document.querySelectorAll('.student-card');
            cards.forEach(card => {
                card.classList.remove('excluded');
            });
        }

        drawBtn.addEventListener('click', drawStu);
        resetBtn.addEventListener('click', resetExc);
        selAllBtn.addEventListener('click', allStu);
        selNoneBtn.addEventListener('click', noneStu);

        initStu();

        // 在控制台可以修改权重，例如：stuData[0].weight = 5
        console.log('权重调整方法：在控制台输入 stuData[索引].weight = 新权重');
        console.log('例如：stuData[0].weight = 5 将"白劭溥"的权重设为5');
    </script>
</body>
</html>
